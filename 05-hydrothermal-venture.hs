testData =  "0,9 -> 5,9\n\
            \8,0 -> 0,8\n\
            \9,4 -> 3,4\n\
            \2,2 -> 2,1\n\
            \7,0 -> 7,4\n\
            \6,4 -> 2,0\n\
            \0,9 -> 2,9\n\
            \3,4 -> 1,4\n\
            \0,0 -> 8,8\n\
            \5,5 -> 8,2"

realData =  "445,187 -> 912,654\n\
            \820,46 -> 25,841\n\
            \216,621 -> 458,379\n\
            \955,898 -> 67,10\n\
            \549,572 -> 549,520\n\
            \796,107 -> 109,794\n\
            \729,698 -> 338,698\n\
            \11,987 -> 968,30\n\
            \381,840 -> 381,409\n\
            \80,467 -> 80,48\n\
            \132,197 -> 132,92\n\
            \343,96 -> 343,710\n\
            \42,854 -> 346,550\n\
            \503,56 -> 804,56\n\
            \599,206 -> 60,206\n\
            \702,920 -> 474,920\n\
            \496,790 -> 223,517\n\
            \969,579 -> 583,579\n\
            \897,66 -> 604,66\n\
            \484,754 -> 640,910\n\
            \330,49 -> 949,49\n\
            \908,132 -> 714,132\n\
            \517,153 -> 97,573\n\
            \317,865 -> 678,504\n\
            \800,61 -> 800,51\n\
            \179,242 -> 179,202\n\
            \529,757 -> 529,838\n\
            \288,953 -> 393,953\n\
            \372,15 -> 925,568\n\
            \100,85 -> 654,639\n\
            \663,562 -> 737,636\n\
            \576,981 -> 245,981\n\
            \347,240 -> 347,928\n\
            \91,119 -> 413,441\n\
            \637,397 -> 330,90\n\
            \534,257 -> 950,257\n\
            \155,636 -> 694,97\n\
            \539,274 -> 539,327\n\
            \329,795 -> 824,300\n\
            \103,51 -> 961,909\n\
            \87,868 -> 168,787\n\
            \21,250 -> 157,386\n\
            \591,316 -> 670,395\n\
            \722,670 -> 630,670\n\
            \28,167 -> 28,489\n\
            \480,210 -> 68,622\n\
            \573,700 -> 354,919\n\
            \186,59 -> 700,59\n\
            \121,186 -> 670,186\n\
            \797,985 -> 671,985\n\
            \836,804 -> 335,804\n\
            \701,835 -> 104,238\n\
            \456,718 -> 456,964\n\
            \694,891 -> 694,839\n\
            \205,637 -> 205,318\n\
            \40,958 -> 773,225\n\
            \151,391 -> 151,779\n\
            \693,894 -> 417,894\n\
            \418,700 -> 656,700\n\
            \196,985 -> 896,985\n\
            \357,509 -> 608,258\n\
            \552,558 -> 552,482\n\
            \184,412 -> 170,412\n\
            \122,746 -> 643,225\n\
            \268,930 -> 247,930\n\
            \979,820 -> 407,248\n\
            \755,893 -> 845,893\n\
            \706,843 -> 706,225\n\
            \162,726 -> 895,726\n\
            \140,888 -> 289,888\n\
            \614,432 -> 903,721\n\
            \272,725 -> 272,598\n\
            \529,672 -> 967,234\n\
            \903,989 -> 785,871\n\
            \422,355 -> 422,360\n\
            \313,722 -> 713,322\n\
            \460,121 -> 460,151\n\
            \55,944 -> 946,944\n\
            \795,744 -> 221,744\n\
            \816,953 -> 471,953\n\
            \865,186 -> 557,186\n\
            \94,976 -> 747,323\n\
            \302,961 -> 811,452\n\
            \361,966 -> 921,406\n\
            \197,988 -> 571,988\n\
            \310,905 -> 722,493\n\
            \699,91 -> 272,518\n\
            \295,306 -> 84,95\n\
            \220,116 -> 395,291\n\
            \183,364 -> 523,364\n\
            \16,986 -> 16,319\n\
            \54,980 -> 635,399\n\
            \340,110 -> 651,421\n\
            \788,76 -> 788,635\n\
            \933,375 -> 458,375\n\
            \12,434 -> 494,916\n\
            \253,892 -> 962,183\n\
            \240,508 -> 240,234\n\
            \763,934 -> 506,677\n\
            \308,135 -> 239,66\n\
            \117,649 -> 751,15\n\
            \95,535 -> 428,868\n\
            \16,937 -> 902,51\n\
            \547,404 -> 547,830\n\
            \128,581 -> 970,581\n\
            \959,810 -> 564,415\n\
            \971,738 -> 378,145\n\
            \919,210 -> 295,210\n\
            \737,43 -> 231,43\n\
            \82,577 -> 455,204\n\
            \821,337 -> 570,337\n\
            \688,753 -> 538,753\n\
            \891,844 -> 124,844\n\
            \74,957 -> 946,85\n\
            \43,942 -> 43,210\n\
            \100,391 -> 100,142\n\
            \975,527 -> 175,527\n\
            \510,844 -> 395,959\n\
            \558,231 -> 558,858\n\
            \839,915 -> 262,338\n\
            \784,290 -> 875,199\n\
            \644,824 -> 812,824\n\
            \899,657 -> 500,657\n\
            \263,668 -> 263,964\n\
            \157,374 -> 820,374\n\
            \530,301 -> 530,67\n\
            \15,688 -> 15,572\n\
            \216,844 -> 479,581\n\
            \973,59 -> 68,964\n\
            \104,92 -> 104,547\n\
            \421,472 -> 421,176\n\
            \887,805 -> 231,149\n\
            \140,980 -> 852,980\n\
            \248,602 -> 346,602\n\
            \334,961 -> 334,471\n\
            \892,892 -> 958,958\n\
            \270,83 -> 270,135\n\
            \950,105 -> 404,651\n\
            \979,476 -> 930,427\n\
            \416,430 -> 879,430\n\
            \796,937 -> 796,415\n\
            \670,679 -> 72,679\n\
            \733,884 -> 733,302\n\
            \745,196 -> 306,196\n\
            \174,353 -> 667,846\n\
            \285,978 -> 254,978\n\
            \10,63 -> 936,989\n\
            \242,107 -> 242,725\n\
            \238,341 -> 238,800\n\
            \975,102 -> 174,903\n\
            \530,474 -> 530,853\n\
            \931,47 -> 467,47\n\
            \86,141 -> 821,141\n\
            \263,15 -> 654,15\n\
            \688,542 -> 378,232\n\
            \826,793 -> 989,793\n\
            \729,285 -> 729,192\n\
            \587,915 -> 587,79\n\
            \548,667 -> 877,667\n\
            \15,836 -> 783,68\n\
            \662,673 -> 71,82\n\
            \312,681 -> 910,83\n\
            \760,418 -> 491,418\n\
            \175,502 -> 443,502\n\
            \817,878 -> 29,90\n\
            \798,569 -> 811,582\n\
            \703,141 -> 743,181\n\
            \941,849 -> 941,778\n\
            \63,24 -> 500,461\n\
            \697,183 -> 119,761\n\
            \705,672 -> 152,672\n\
            \150,567 -> 656,567\n\
            \158,411 -> 965,411\n\
            \702,872 -> 276,446\n\
            \141,179 -> 741,779\n\
            \533,886 -> 817,886\n\
            \569,949 -> 285,949\n\
            \699,764 -> 699,780\n\
            \333,863 -> 805,391\n\
            \861,804 -> 524,467\n\
            \791,501 -> 718,501\n\
            \976,265 -> 976,713\n\
            \129,342 -> 339,132\n\
            \322,738 -> 212,738\n\
            \700,534 -> 622,456\n\
            \68,314 -> 14,314\n\
            \146,112 -> 215,181\n\
            \170,211 -> 482,211\n\
            \159,412 -> 159,32\n\
            \312,939 -> 312,95\n\
            \232,18 -> 912,698\n\
            \950,114 -> 950,826\n\
            \620,848 -> 620,11\n\
            \624,288 -> 544,208\n\
            \752,479 -> 752,577\n\
            \784,796 -> 784,872\n\
            \130,55 -> 974,899\n\
            \434,82 -> 434,481\n\
            \988,230 -> 892,134\n\
            \159,252 -> 159,291\n\
            \462,14 -> 462,977\n\
            \553,981 -> 553,390\n\
            \231,936 -> 51,936\n\
            \58,759 -> 60,759\n\
            \572,891 -> 584,891\n\
            \705,303 -> 124,303\n\
            \144,894 -> 970,68\n\
            \865,275 -> 865,956\n\
            \492,491 -> 470,491\n\
            \971,15 -> 977,15\n\
            \750,521 -> 33,521\n\
            \913,947 -> 387,421\n\
            \368,677 -> 570,677\n\
            \795,186 -> 882,186\n\
            \404,840 -> 678,840\n\
            \187,488 -> 403,488\n\
            \824,706 -> 642,706\n\
            \330,541 -> 330,195\n\
            \564,531 -> 774,531\n\
            \271,857 -> 20,606\n\
            \976,975 -> 976,843\n\
            \323,341 -> 21,39\n\
            \575,643 -> 267,643\n\
            \827,295 -> 827,854\n\
            \749,486 -> 749,780\n\
            \656,716 -> 656,470\n\
            \635,187 -> 417,187\n\
            \503,488 -> 503,393\n\
            \592,688 -> 592,567\n\
            \515,408 -> 128,795\n\
            \608,158 -> 780,158\n\
            \677,96 -> 11,762\n\
            \127,452 -> 339,452\n\
            \117,985 -> 291,811\n\
            \157,371 -> 157,916\n\
            \640,758 -> 983,758\n\
            \906,413 -> 906,776\n\
            \224,842 -> 627,439\n\
            \903,728 -> 903,459\n\
            \358,138 -> 822,602\n\
            \30,16 -> 929,915\n\
            \440,900 -> 294,900\n\
            \809,73 -> 987,73\n\
            \55,410 -> 304,161\n\
            \441,672 -> 315,672\n\
            \939,40 -> 234,40\n\
            \334,698 -> 309,698\n\
            \572,738 -> 572,226\n\
            \445,71 -> 445,468\n\
            \225,660 -> 427,458\n\
            \390,320 -> 449,320\n\
            \507,635 -> 507,169\n\
            \47,116 -> 738,807\n\
            \127,14 -> 689,14\n\
            \316,760 -> 316,432\n\
            \831,101 -> 250,682\n\
            \370,807 -> 370,898\n\
            \678,186 -> 491,186\n\
            \866,83 -> 539,83\n\
            \518,848 -> 518,962\n\
            \188,135 -> 81,28\n\
            \378,226 -> 597,226\n\
            \646,534 -> 141,534\n\
            \275,672 -> 275,854\n\
            \67,421 -> 676,421\n\
            \386,323 -> 988,323\n\
            \903,984 -> 10,91\n\
            \37,348 -> 529,840\n\
            \872,134 -> 358,648\n\
            \42,826 -> 42,822\n\
            \688,922 -> 21,922\n\
            \47,539 -> 942,539\n\
            \739,483 -> 375,847\n\
            \23,217 -> 800,217\n\
            \589,512 -> 589,953\n\
            \292,229 -> 107,229\n\
            \873,678 -> 873,770\n\
            \794,295 -> 739,240\n\
            \464,559 -> 936,559\n\
            \685,736 -> 368,736\n\
            \114,941 -> 114,307\n\
            \571,643 -> 74,643\n\
            \281,185 -> 273,177\n\
            \497,937 -> 497,469\n\
            \152,815 -> 702,815\n\
            \76,43 -> 980,947\n\
            \272,149 -> 101,149\n\
            \934,945 -> 107,118\n\
            \532,476 -> 759,476\n\
            \955,942 -> 397,942\n\
            \31,918 -> 931,18\n\
            \790,420 -> 389,420\n\
            \36,496 -> 215,317\n\
            \252,209 -> 139,209\n\
            \704,148 -> 719,133\n\
            \413,571 -> 165,571\n\
            \690,433 -> 864,607\n\
            \976,417 -> 517,876\n\
            \803,568 -> 443,568\n\
            \335,558 -> 335,334\n\
            \405,807 -> 691,521\n\
            \194,482 -> 486,190\n\
            \377,856 -> 377,802\n\
            \313,842 -> 313,254\n\
            \449,961 -> 198,710\n\
            \197,916 -> 197,797\n\
            \82,965 -> 959,88\n\
            \371,239 -> 829,697\n\
            \471,70 -> 596,70\n\
            \835,144 -> 835,950\n\
            \283,486 -> 506,486\n\
            \147,29 -> 147,747\n\
            \187,485 -> 187,195\n\
            \781,144 -> 480,144\n\
            \801,839 -> 925,715\n\
            \415,960 -> 415,442\n\
            \877,939 -> 29,91\n\
            \22,118 -> 22,439\n\
            \460,315 -> 450,315\n\
            \982,960 -> 71,49\n\
            \105,231 -> 105,331\n\
            \98,174 -> 551,174\n\
            \721,978 -> 38,295\n\
            \167,290 -> 167,133\n\
            \218,158 -> 218,908\n\
            \819,812 -> 758,812\n\
            \123,92 -> 123,132\n\
            \66,721 -> 66,906\n\
            \478,441 -> 967,930\n\
            \284,58 -> 464,58\n\
            \958,15 -> 37,936\n\
            \310,337 -> 359,288\n\
            \212,763 -> 212,373\n\
            \101,279 -> 101,267\n\
            \622,409 -> 106,925\n\
            \318,657 -> 318,432\n\
            \938,631 -> 938,650\n\
            \142,881 -> 254,881\n\
            \848,987 -> 848,451\n\
            \686,223 -> 481,223\n\
            \124,248 -> 812,248\n\
            \246,267 -> 246,148\n\
            \96,670 -> 324,442\n\
            \645,888 -> 385,628\n\
            \417,555 -> 417,858\n\
            \543,495 -> 543,150\n\
            \73,350 -> 440,717\n\
            \459,704 -> 459,179\n\
            \871,493 -> 871,764\n\
            \911,34 -> 64,881\n\
            \544,791 -> 703,791\n\
            \447,218 -> 62,218\n\
            \202,649 -> 396,649\n\
            \935,916 -> 55,36\n\
            \124,408 -> 477,761\n\
            \608,850 -> 484,850\n\
            \935,876 -> 582,876\n\
            \377,612 -> 269,612\n\
            \413,727 -> 365,679\n\
            \64,451 -> 850,451\n\
            \684,807 -> 357,807\n\
            \323,364 -> 372,364\n\
            \887,300 -> 419,300\n\
            \837,831 -> 837,927\n\
            \294,255 -> 768,729\n\
            \878,23 -> 141,760\n\
            \36,627 -> 157,627\n\
            \824,703 -> 824,968\n\
            \356,109 -> 657,109\n\
            \799,266 -> 313,752\n\
            \71,600 -> 650,21\n\
            \564,863 -> 564,54\n\
            \36,720 -> 109,720\n\
            \318,488 -> 682,488\n\
            \249,350 -> 979,350\n\
            \560,502 -> 255,502\n\
            \132,327 -> 132,246\n\
            \287,906 -> 791,906\n\
            \818,110 -> 818,882\n\
            \937,17 -> 113,841\n\
            \50,710 -> 673,87\n\
            \702,952 -> 702,533\n\
            \666,552 -> 611,552\n\
            \612,962 -> 112,462\n\
            \260,529 -> 351,529\n\
            \440,313 -> 440,663\n\
            \605,341 -> 405,141\n\
            \277,287 -> 461,287\n\
            \268,890 -> 268,92\n\
            \764,526 -> 877,639\n\
            \165,697 -> 832,697\n\
            \240,716 -> 801,155\n\
            \872,429 -> 578,429\n\
            \88,816 -> 338,816\n\
            \981,881 -> 981,138\n\
            \457,351 -> 457,679\n\
            \850,526 -> 850,447\n\
            \139,449 -> 165,449\n\
            \127,544 -> 127,934\n\
            \160,890 -> 745,305\n\
            \526,113 -> 303,336\n\
            \17,500 -> 17,621\n\
            \796,311 -> 181,926\n\
            \260,218 -> 787,218\n\
            \536,989 -> 536,261\n\
            \257,826 -> 257,180\n\
            \531,37 -> 531,493\n\
            \961,942 -> 206,187\n\
            \536,668 -> 536,868\n\
            \154,967 -> 154,931\n\
            \808,317 -> 808,873\n\
            \487,258 -> 599,258\n\
            \59,962 -> 802,219\n\
            \322,945 -> 322,837\n\
            \378,973 -> 33,628\n\
            \668,556 -> 691,556\n\
            \819,728 -> 787,728\n\
            \484,261 -> 484,874\n\
            \333,271 -> 278,271\n\
            \733,515 -> 741,523\n\
            \775,854 -> 523,602\n\
            \67,215 -> 616,215\n\
            \951,685 -> 951,433\n\
            \372,105 -> 372,494\n\
            \917,788 -> 917,23\n\
            \890,584 -> 245,584\n\
            \748,276 -> 893,276\n\
            \733,721 -> 733,747\n\
            \225,908 -> 897,908\n\
            \437,140 -> 423,140\n\
            \456,513 -> 136,833\n\
            \413,135 -> 413,596\n\
            \143,245 -> 879,981\n\
            \870,639 -> 942,639\n\
            \28,175 -> 696,843\n\
            \393,303 -> 393,197\n\
            \169,986 -> 458,986\n\
            \43,44 -> 952,953\n\
            \236,405 -> 60,229\n\
            \266,845 -> 292,845\n\
            \529,98 -> 95,532\n\
            \95,658 -> 695,658\n\
            \368,454 -> 112,710\n\
            \506,776 -> 662,776\n\
            \928,494 -> 604,170\n\
            \179,138 -> 900,859\n\
            \45,560 -> 408,197\n\
            \655,654 -> 37,36\n\
            \56,432 -> 56,456\n\
            \844,614 -> 844,898\n\
            \240,191 -> 240,112\n\
            \639,911 -> 213,911\n\
            \47,887 -> 830,104\n\
            \57,50 -> 977,970\n\
            \899,928 -> 111,928\n\
            \962,676 -> 962,518\n\
            \129,585 -> 469,245\n\
            \988,775 -> 988,553\n\
            \417,344 -> 842,769\n\
            \468,110 -> 506,72\n\
            \687,204 -> 687,345\n\
            \828,553 -> 765,490\n\
            \75,894 -> 75,93\n\
            \26,798 -> 11,783\n\
            \967,44 -> 967,478\n\
            \240,481 -> 947,481\n\
            \794,254 -> 162,254\n\
            \502,944 -> 812,944\n\
            \331,417 -> 410,417\n\
            \850,275 -> 850,980\n\
            \671,130 -> 671,941\n\
            \240,99 -> 240,381\n\
            \771,399 -> 318,399\n\
            \946,11 -> 28,929\n\
            \731,939 -> 824,846\n\
            \268,71 -> 832,635\n\
            \968,37 -> 968,642\n\
            \935,365 -> 515,365\n\
            \199,792 -> 932,792\n\
            \32,116 -> 371,116\n\
            \324,67 -> 941,67\n\
            \453,181 -> 453,128\n\
            \958,982 -> 115,139\n\
            \962,168 -> 154,976\n\
            \474,215 -> 333,215\n\
            \458,675 -> 458,315\n\
            \577,302 -> 300,302\n\
            \704,493 -> 704,876\n\
            \887,549 -> 887,439\n\
            \81,328 -> 724,328\n\
            \575,490 -> 670,490\n\
            \576,17 -> 576,218\n\
            \21,46 -> 963,988\n\
            \532,235 -> 532,615\n\
            \796,213 -> 796,407\n\
            \55,948 -> 980,23\n\
            \775,471 -> 272,471\n\
            \26,138 -> 344,138\n\
            \635,518 -> 915,518\n\
            \727,365 -> 727,216"

data Point = Point Int Int deriving(Show)
data Line  = Line [Point] deriving(Show)
data Grid  = Grid [[Int]] deriving(Show)

getLinesFromInput :: String -> [Line]
getLinesFromInput s = map splitStringByArrow $ lines s 

splitStringByArrow :: String -> Line
splitStringByArrow s = lineFromPoints (stringToPoint (fst $ break (== ' ') s)) (stringToPoint (reverse (fst (break (== ' ') (reverse s)))))

stringToPoint :: String -> Point
stringToPoint s = Point (read (fst $ break (== ',') s)) (read (reverse (fst (break (== ',') (reverse s)))))

dissolveLines :: [Line] -> [Point]
dissolveLines [] = []
dissolveLines ((Line l):ls) = l ++ (dissolveLines ls)

addPointsToGrid :: [Point] -> Grid -> Grid
addPointsToGrid [] g = g
addPointsToGrid (p:ps) g = addPoint p (addPointsToGrid ps g)

firstGrid = addPointsToGrid (dissolveLines (getLinesFromInput testData)) (initialGrid 10 10)
finalGrid = addPointsToGrid (dissolveLines (getLinesFromInput realData)) (initialGrid 1000 1000)

findDangerZones :: Grid -> Int 
findDangerZones (Grid rows) = length (filter (>1) (concat rows))

initialGrid :: Int -> Int -> Grid
initialGrid width height = Grid $ take height ( repeat (take width (repeat 0)))

addPoint :: Point -> Grid -> Grid
addPoint (Point x y) (Grid rows) = Grid (take y rows ++ [(addPointToRow x (rows !! y))] ++ (drop (y + 1) rows))

addLine :: Line -> Grid -> Grid
addLine (Line []) (Grid g) = Grid g
addLine (Line (x:xs)) (Grid g) = addPoint x (addLine (Line xs) (Grid g))

addPointToRow :: Int -> [Int] -> [Int]
addPointToRow _ [] = []
addPointToRow i (r:rs) = toInsert:(addPointToRow (i - 1) rs)
  where toInsert = if i == 0 then r + 1 else r

lineFromPoints :: Point -> Point -> Line
lineFromPoints (Point x1 y1) (Point x2 y2) = 
  if (x1 == x2) then Line (verticalLine x1 y1 y2) else 
  if (y1 == y2) then Line (horizontalLine y1 x1 x2) else
  Line (diagonalLine x1 x2 y1 y2)

verticalLine :: Int -> Int -> Int -> [Point]
verticalLine x y1 y2 = 
  if y1 == y2 then [Point x y1] else
  if y1 >  y2 then Point x y1 : verticalLine x (y1 - 1) y2 else
  if y1 <  y2 then Point x y1 : verticalLine x (y1 + 1) y2 else
  []

horizontalLine :: Int -> Int -> Int -> [Point]
horizontalLine y x1 x2 =
  if x1 == x2 then [Point x1 y] else
  if x1 >  x2 then Point x1 y : horizontalLine y (x1 - 1) x2 else
  if x1 <  x2 then Point x1 y : horizontalLine y (x1 + 1) x2 else
  []

diagonalLine :: Int -> Int -> Int -> Int -> [Point]
diagonalLine x1 x2 y1 y2 =
  if x1 == x2           then [Point x1 y1] else
  if x1 > x2 && y1 > y2 then Point x1 y1 : diagonalLine (x1 - 1) x2 (y1 - 1) y2 else
  if x1 > x2 && y1 < y2 then Point x1 y1 : diagonalLine (x1 - 1) x2 (y1 + 1) y2 else
  if x1 < x2 && y1 > y2 then Point x1 y1 : diagonalLine (x1 + 1) x2 (y1 - 1) y2 else
  if x1 < x2 && y1 < y2 then Point x1 y1 : diagonalLine (x1 + 1) x2 (y1 + 1) y2 else
  []

-- findDangerZones finalGrid takes over 4 minutes to run. I'm not convinced of the supposed "blinding speed" of this language